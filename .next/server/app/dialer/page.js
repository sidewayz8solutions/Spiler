(()=>{var e={};e.id=263,e.ids=[263],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},6693:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>d});var a=r(482),n=r(9108),s=r(2563),o=r.n(s),l=r(8300),i={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>l[e]);r.d(t,i);let d=["",{children:["dialer",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,7478)),"/Users/sidewayz8/Spiler/src/app/dialer/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,847)),"/Users/sidewayz8/Spiler/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9361,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/sidewayz8/Spiler/src/app/dialer/page.tsx"],u="/dialer/page",m={require:r,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/dialer/page",pathname:"/dialer",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},3414:(e,t,r)=>{Promise.resolve().then(r.bind(r,5143))},5143:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>D});var a=r(5344),n=r(3729),s=r(4669);let o=n.forwardRef(function({title:e,titleId:t,...r},a){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),e?n.createElement("title",{id:t},e):null,n.createElement("path",{fillRule:"evenodd",d:"M1.5 4.5a3 3 0 0 1 3-3h1.372c.86 0 1.61.586 1.819 1.42l1.105 4.423a1.875 1.875 0 0 1-.694 1.955l-1.293.97c-.135.101-.164.249-.126.352a11.285 11.285 0 0 0 6.697 6.697c.103.038.25.009.352-.126l.97-1.293a1.875 1.875 0 0 1 1.955-.694l4.423 1.105c.834.209 1.42.959 1.42 1.82V19.5a3 3 0 0 1-3 3h-2.25C8.552 22.5 1.5 15.448 1.5 6.75V4.5Z",clipRule:"evenodd"}))}),l=n.forwardRef(function({title:e,titleId:t,...r},a){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),e?n.createElement("title",{id:t},e):null,n.createElement("path",{d:"M5.055 7.06C3.805 6.347 2.25 7.25 2.25 8.69v8.122c0 1.44 1.555 2.343 2.805 1.628L12 14.471v2.34c0 1.44 1.555 2.343 2.805 1.628l7.108-4.061c1.26-.72 1.26-2.536 0-3.256l-7.108-4.061C13.555 6.346 12 7.249 12 8.689v2.34L5.055 7.061Z"}))});function i({onStartCall:e,onSkip:t,disabled:r}){return(0,a.jsxs)("div",{className:"card",children:[a.jsx("h3",{className:"font-semibold mb-4",children:"Call Controls"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("button",{onClick:e,disabled:r,className:"w-full btn btn-primary py-4 text-lg disabled:opacity-50 disabled:cursor-not-allowed",children:[a.jsx(o,{className:"w-6 h-6 mr-2"}),"Start Call"]}),(0,a.jsxs)("button",{onClick:t,disabled:r,className:"w-full btn btn-secondary py-3",children:[a.jsx(l,{className:"w-5 h-5 mr-2"}),"Skip to Next"]})]}),a.jsx("div",{className:"mt-4 p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:a.jsx("p",{className:"text-xs text-blue-400",children:"Clicking \"Start Call\" will open your phone's dialer with the donor's number"})})]})}var d=r(7902);function c({duration:e}){let[t,r]=(0,n.useState)(e||0);return(0,n.useEffect)(()=>{let e=setInterval(()=>{r(e=>e+1)},1e3);return()=>clearInterval(e)},[]),a.jsx("div",{className:"card bg-green-500/10 border-green-500/20",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"p-2 bg-green-500/20 rounded-lg",children:a.jsx(d.Z,{className:"w-5 h-5 text-green-400"})}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs text-gray-400",children:"Call Duration"}),a.jsx("p",{className:"text-2xl font-bold font-mono text-green-400",children:`${Math.floor(t/60).toString().padStart(2,"0")}:${(t%60).toString().padStart(2,"0")}`})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("span",{className:"relative flex h-3 w-3",children:[a.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),a.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-green-500"})]}),a.jsx("span",{className:"text-sm text-green-400",children:"Active"})]})]})})}var u=r(4968),m=r(7602);function x({donor:e,onSubmit:t,onCancel:r}){let[s,o]=(0,n.useState)(""),[l,i]=(0,n.useState)(""),[d,c]=(0,n.useState)(!1),x=async e=>{if(e.preventDefault(),!(!s||isNaN(parseFloat(s))||0>=parseFloat(s))){c(!0);try{await t(parseFloat(s),l)}finally{c(!1)}}};return a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"card max-w-md w-full mx-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"p-2 bg-green-500/20 rounded-lg",children:a.jsx(u.Z,{className:"w-5 h-5 text-green-400"})}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"font-semibold text-white",children:"Record Donation"}),a.jsx("p",{className:"text-sm text-gray-400",children:e?.full_name})]})]}),a.jsx("button",{type:"button",onClick:r,className:"p-1 hover:bg-gray-700 rounded-lg transition-colors",title:"Close donation form",children:a.jsx(m.Z,{className:"w-5 h-5 text-gray-400"})})]}),(0,a.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-300 mb-2",children:"Donation Amount ($)"}),a.jsx("input",{type:"number",id:"amount",value:s,onChange:e=>o(e.target.value),className:"input",placeholder:"0.00",min:"0",step:"0.01",required:!0,autoFocus:!0})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-300 mb-2",children:"Notes (Optional)"}),a.jsx("textarea",{id:"notes",value:l,onChange:e=>i(e.target.value),className:"input min-h-[80px] resize-none",placeholder:"Any additional notes about the donation..."})]}),(0,a.jsxs)("div",{className:"flex space-x-3 pt-4",children:[a.jsx("button",{type:"button",onClick:r,className:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",disabled:d,children:"Cancel"}),a.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors disabled:opacity-50",disabled:d||!s,children:d?"Recording...":"Record Donation"})]})]})]})})}var p=r(8360);let h=n.forwardRef(function({title:e,titleId:t,...r},a){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75"}))});function g({donor:e}){let t=e.previous_donation_amount>1e3?{text:"Major Donor",color:"bg-yellow-500"}:e.previous_donation_amount>500?{text:"High Value",color:"bg-purple-500"}:e.previous_donation_amount>0?{text:"Previous Donor",color:"bg-green-500"}:{text:"New Prospect",color:"bg-blue-500"};return(0,a.jsxs)("div",{className:"card gradient-border",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[e.full_name,a.jsx("span",{className:`${t.color} text-white text-xs px-2 py-1 rounded-full`,children:t.text})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mt-2",children:[(0,a.jsxs)("div",{className:"flex items-center text-gray-400",children:[a.jsx(p.Z,{className:"w-4 h-4 mr-1"}),a.jsx("span",{className:"text-sm",children:e.phone})]}),e.email&&(0,a.jsxs)("div",{className:"flex items-center text-gray-400",children:[a.jsx(h,{className:"w-4 h-4 mr-1"}),a.jsx("span",{className:"text-sm",children:e.email})]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[a.jsx("p",{className:"text-sm text-gray-400",children:"Score"}),a.jsx("p",{className:"text-2xl font-bold text-gradient",children:e.score||50})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t border-indigo-500/20",children:[(0,a.jsxs)("div",{className:"glass rounded-lg p-3",children:[a.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Previous Donation"}),(0,a.jsxs)("p",{className:"text-lg font-semibold",children:["$",e.previous_donation_amount||0]})]}),(0,a.jsxs)("div",{className:"glass rounded-lg p-3",children:[a.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Total Donated"}),(0,a.jsxs)("p",{className:"text-lg font-semibold",children:["$",e.total_donated||0]})]}),(0,a.jsxs)("div",{className:"glass rounded-lg p-3",children:[a.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Last Contact"}),a.jsx("p",{className:"text-lg font-semibold",children:e.last_contact_date?new Date(e.last_contact_date).toLocaleDateString():"Never"})]})]}),e.notes&&(0,a.jsxs)("div",{className:"mt-4 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:[a.jsx("p",{className:"text-sm text-yellow-400",children:"Previous Notes:"}),a.jsx("p",{className:"text-sm mt-1",children:e.notes})]})]})}let f=n.forwardRef(function({title:e,titleId:t,...r},a){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728A9 9 0 0 1 5.636 5.636m12.728 12.728L5.636 5.636"}))}),b=n.forwardRef(function({title:e,titleId:t,...r},a){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"}))});function v({onSelectOutcome:e}){let t=[{id:"donated",label:"Donated",icon:u.Z,color:"bg-green-500 hover:bg-green-600",description:"Donor made a contribution"},{id:"callback",label:"Call Back",icon:p.Z,color:"bg-yellow-500 hover:bg-yellow-600",description:"Schedule a follow-up call"},{id:"not_interested",label:"Not Interested",icon:m.Z,color:"bg-red-500 hover:bg-red-600",description:"Donor declined to contribute"},{id:"no_answer",label:"No Answer",icon:f,color:"bg-gray-500 hover:bg-gray-600",description:"No one answered the call"},{id:"voicemail",label:"Voicemail",icon:b,color:"bg-purple-500 hover:bg-purple-600",description:"Left a voicemail message"}];return(0,a.jsxs)("div",{className:"card",children:[a.jsx("h3",{className:"font-semibold mb-4",children:"Call Outcome"}),a.jsx("div",{className:"space-y-3",children:t.map(t=>{let r=t.icon;return a.jsx("button",{type:"button",onClick:()=>e(t.id),className:`w-full p-4 rounded-lg text-white font-medium transition-all duration-200 transform hover:scale-105 ${t.color}`,children:(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-3",children:[a.jsx(r,{className:"w-5 h-5"}),a.jsx("span",{children:t.label})]})},t.id)})}),a.jsx("div",{className:"mt-4 p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:a.jsx("p",{className:"text-xs text-blue-400",children:"Select the outcome of your call to record it and move to the next donor"})})]})}let w=n.forwardRef(function({title:e,titleId:t,...r},a){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z"}))});function j({donor:e}){let[t,r]=(0,n.useState)(null),[s,o]=(0,n.useState)("opening");if((0,n.useEffect)(()=>{r(function(e){let t=e.previous_donation_amount>0,r=e.first_name||e.full_name?.split(" ")[0]||"there",a=new Date().getHours();return{opening:`${a<12?"Good morning":a<17?"Good afternoon":"Good evening"} ${r}, this is {fundraiser_name} from {campaign_name}. ${t?`Thank you so much for your previous support of $${e.previous_donation_amount}. Your generosity made a real difference.`:"I'm reaching out to supporters in our community who care about making a difference."} Do you have a moment to talk?`,pitch:t?"As you know from your previous involvement, we're working hard to [campaign goal]. Thanks to supporters like you, we've already [achievement]. Now we're in the final push and every contribution matters.":"We're working to [campaign goal] and we're reaching out to community members who might be interested in supporting our cause. We've already [achievement] and with your help, we can [future goal].",ask:t?`Would you consider matching or even increasing your previous donation of $${e.previous_donation_amount}? Many of our supporters are doubling their impact this time around.`:"Would you be willing to support our campaign today? We have supporters contributing anywhere from $25 to $500, and every amount makes a difference.",objections:{"I don't have money right now":t?"I completely understand. Would you consider a smaller amount, even $25 would help us reach our goal. Or we could schedule a pledge for next month?":"I understand completely. Even a small contribution of $10 or $15 can make a difference. Or if you'd prefer, I can follow up with you next month.","I already donated":"Thank you so much for your support! Your previous contribution means a lot. Many of our strongest supporters are choosing to give again to help us reach our goal. Would you consider an additional contribution?","I need to think about it":"Of course, it's an important decision. Can I answer any questions about how the funds will be used? I'd also be happy to send you more information and follow up in a few days.","Not interested":"I understand, and I appreciate you taking the time to speak with me. Before I go, is there anything specific about our campaign that concerns you? Your feedback is valuable to us.","How will the money be used?":"Great question! [Specific breakdown of fund usage]. We're committed to transparency and can provide detailed reports on how every dollar is spent."},closing:`Thank you so much for your time today, ${r}. ${t?"Your continued support means everything to us.":"We're grateful for your consideration."} Have a wonderful ${a>=17?"evening":"day"}!`}}(e))},[e]),!t)return null;let l=[{id:"opening",label:"Opening",content:t.opening},{id:"pitch",label:"Pitch",content:t.pitch},{id:"ask",label:"Ask",content:t.ask},{id:"objections",label:"Objections",content:t.objections},{id:"closing",label:"Closing",content:t.closing}];return(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"AI Script Assistant"}),a.jsx(w,{className:"w-5 h-5 text-indigo-400"})]}),a.jsx("div",{className:"flex space-x-2 mb-4 overflow-x-auto",children:l.map(e=>a.jsx("button",{onClick:()=>o(e.id),className:`
              px-4 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap
              ${s===e.id?"bg-indigo-500 text-white":"bg-spiler-dark/50 text-gray-400 hover:text-white"}
            `,children:e.label},e.id))}),a.jsx("div",{className:"bg-spiler-dark/30 rounded-lg p-4",children:l.map(e=>a.jsx("div",{className:s===e.id?"block":"hidden",children:"objections"===e.id?a.jsx("div",{className:"space-y-3",children:Object.entries(e.content).map(([e,t])=>(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm text-red-400 mb-1",children:['"',e,'"']}),a.jsx("p",{className:"text-sm pl-4 border-l-2 border-indigo-500",children:t})]},e))}):a.jsx("p",{className:"text-sm leading-relaxed",children:e.content})},e.id))}),(0,a.jsxs)("div",{className:"mt-4 p-3 bg-indigo-500/10 border border-indigo-500/20 rounded-lg",children:[a.jsx("p",{className:"text-xs text-indigo-400 font-semibold mb-1",children:"\uD83D\uDCA1 Quick Tip:"}),a.jsx("p",{className:"text-xs text-gray-300",children:e.previous_donation_amount>0?"Reference their previous support early in the conversation":"Focus on the impact their first donation will make"})]})]})}var y=r(5101),N=r(4614),_=r(3158),k=r(7635);let C=(0,_.Ue)((e,t)=>({currentDonor:null,currentCall:null,isCallActive:!1,callStartTime:null,callDuration:0,queue:[],setCurrentDonor:t=>e({currentDonor:t}),setCurrentCall:t=>e({currentCall:t}),setCallActive:t=>e({isCallActive:t}),setCallStartTime:t=>e({callStartTime:t}),setCallDuration:t=>e({callDuration:t}),setQueue:t=>e({queue:t}),reset:()=>e({currentDonor:null,currentCall:null,isCallActive:!1,callStartTime:null,callDuration:0})}));var S=r(6519);function D(){let{user:e,organization:t}=(0,N.a)(),{queue:r}=(0,S.q_)(t?.id),{currentDonor:o,isCallActive:l,callDuration:d,loadNextDonor:u,startCall:m,endCall:p,recordOutcome:h}=function(){let e=(0,k.useSupabase)(),{organization:t,teamMember:r}=(0,N.a)(),{currentDonor:a,currentCall:n,isCallActive:o,callDuration:l,queue:i,setCurrentDonor:d,setCurrentCall:c,setCallActive:u,setCallStartTime:m,setCallDuration:x,setQueue:p,reset:h}=C();async function g(n){try{let{data:s,error:o}=await e.from("calls").insert({organization_id:t.id,donor_id:n,team_member_id:r.id,phone_number:a.phone,status:"active",started_at:new Date().toISOString()}).select().single();if(o)throw o;c(s),u(!0),m(Date.now());let l=setInterval(()=>{let e=Math.floor((Date.now()-Date.now())/1e3);x(e)},1e3);return window.callTimer=l,s}catch(e){console.error("Error starting call:",e),s.default.error("Failed to start call")}}async function f(){window.callTimer&&clearInterval(window.callTimer);let t=Math.floor((Date.now()-get().callStartTime)/1e3);try{let{error:r}=await e.from("calls").update({ended_at:new Date().toISOString(),duration_seconds:t,status:"completed"}).eq("id",n.id);if(r)throw r;u(!1),x(0)}catch(e){console.error("Error ending call:",e)}}async function b(r,o=null,i=""){try{let{error:s}=await e.from("calls").update({outcome:r,donation_amount:o,notes:i,ended_at:new Date().toISOString(),duration_seconds:l}).eq("id",n.id);if(s)throw s;let{error:d}=await e.from("donors").update({status:"donated"===r?"donated":r,last_contact_date:new Date().toISOString(),notes:i?`${a.notes||""}

${new Date().toLocaleDateString()}: ${i}`:a.notes}).eq("id",a.id);if(d)throw d;if("donated"===r&&o){let{error:r}=await e.from("donations").insert({organization_id:t.id,donor_id:a.id,call_id:n.id,amount:o,payment_status:"pending",notes:i});if(r)throw r}return await e.from("call_queue").update({status:"completed"}).eq("donor_id",a.id).eq("organization_id",t.id),u(!1),c(null),x(0),!0}catch(e){return console.error("Error recording outcome:",e),s.default.error("Failed to record outcome"),!1}}return{currentDonor:a,currentCall:n,isCallActive:o,callDuration:l,queue:i,loadNextDonor:async function(){try{let{data:a,error:n}=await e.rpc("get_next_donor",{org_id:t.id,member_id:r.id});if(n)throw n;if(a&&a.length>0){let t=a[0],{data:r}=await e.from("donors").select("*").eq("id",t.donor_id).single();if(r)return d(r),r}else s.default.error("No more donors in queue"),d(null)}catch(e){console.error("Error loading next donor:",e),s.default.error("Failed to load next donor")}},startCall:g,endCall:f,recordOutcome:b}}(),[f,b]=(0,n.useState)(!1),[w,_]=(0,n.useState)(null);(0,n.useEffect)(()=>{!o&&r.length>0&&u()},[r]);let D=async()=>{if(!o){s.default.error("No donor loaded");return}window.location.href=`tel:${o.phone}`,await m(o.id),s.default.success(`Calling ${o.full_name}`)},E=async e=>{_(e),"donated"===e?b(!0):(await h(e),await u(),s.default.success("Call recorded"))},$=async(e,t)=>{await h("donated",e,t),b(!1),await u(),s.default.success(`Donation of $${e} recorded! 🎉`)};return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-spiler-darker to-spiler-dark",children:[a.jsx(y.Z,{}),(0,a.jsxs)("main",{className:"max-w-6xl mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gradient",children:"Dialer"}),(0,a.jsxs)("p",{className:"text-gray-400",children:[r.length," donors in queue"]})]}),(0,a.jsxs)("div",{className:"w-64",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm text-gray-400 mb-2",children:[a.jsx("span",{children:"Progress"}),(0,a.jsxs)("span",{children:[Math.round((1-r.length/100)*100),"%"]})]}),a.jsx("div",{className:"h-2 bg-spiler-dark rounded-full overflow-hidden",children:a.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-500 to-purple-600 transition-all",style:{width:`${Math.round((1-r.length/100)*100)}%`}})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[o?a.jsx(g,{donor:o}):(0,a.jsxs)("div",{className:"card text-center py-12",children:[a.jsx("p",{className:"text-gray-400 mb-4",children:"No donor loaded"}),a.jsx("button",{onClick:u,className:"btn btn-primary",children:"Load Next Donor"})]}),o&&a.jsx(j,{donor:o})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[l&&a.jsx(c,{duration:d}),l?a.jsx(v,{onSelectOutcome:E}):a.jsx(i,{onStartCall:D,onSkip:u,disabled:!o}),(0,a.jsxs)("div",{className:"card",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"Call Notes"}),a.jsx("textarea",{id:"callNotes",className:"input min-h-[100px] resize-none",placeholder:"Enter any notes from the call..."})]})]})]}),f&&a.jsx(x,{donor:o,onSubmit:$,onCancel:()=>b(!1)})]})]})}},7478:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>s,__esModule:()=>n,default:()=>o});let a=(0,r(6843).createProxy)(String.raw`/Users/sidewayz8/Spiler/src/app/dialer/page.tsx`),{__esModule:n,$$typeof:s}=a,o=a.default},7902:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var a=r(3729);let n=a.forwardRef(function({title:e,titleId:t,...r},n){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?a.createElement("title",{id:t},e):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))})},4968:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var a=r(3729);let n=a.forwardRef(function({title:e,titleId:t,...r},n){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?a.createElement("title",{id:t},e):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))})}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[727,495,761,892],()=>r(6693));module.exports=a})();